<form class="job-form"
      #form="ngForm"
      [ngFormOptions]="{updateOn: 'blur'}"
      autocomplete="off" (ngSubmit)="handleSubmit(form)">
<!--     [ngFormOptions]="{updateOn: 'blur'}"  modifica el comportamiento del todo el formulario-->
  <h2>Job Application Form</h2>
<div class="form-group">
    <div class="form-group-box" ngModelGroup="name">
      <!-- First Name -->
      <div class="form-control">
        <label for="first">First</label>
        <input
          id="first"
          name="first"
          type="text"
          placeholder="First"
          [(ngModel)]="applicantForm.name.first"
          [ngModelOptions]="{name: 'first', updateOn: 'change', standalone: false}"
          #first="ngModel"
          required
          minlength="2"
        />
        <!--    Si fuera standalone: true → el control no se registraría en el formulario padre, sería un control independiente. -->
        <!--   updateOn: 'blur' | change | submit -->
        @if (first.touched && first.invalid) {
          <small>
            @if (first.errors?.['required']) { First name is required. }
            @if (first.errors?.['minlength']) { At least 2 characters. }
          </small>
        }
      </div>

      <!-- Last Name -->
      <div class="form-control">
        <label for="last">Last </label>
        <input
          id="last"
          name="last"
          type="text"
          placeholder="Last Name"
          [(ngModel)]="applicantForm.name.last"
          #last="ngModel"
          bannedWord="Doe"
        />
        @if (last.touched && last.invalid) {
          <small>
            @if (last.errors?.['required']) { Last name is required. }
            @if (last.errors?.['minlength']) { At least 2 characters. }
            @if (last.hasError('bannedWordValidator')) {
              @let banneError = last.getError('bannedWordValidator');
              Nombre prohibido <strong>{{ banneError.word }}</strong>
            }
          </small>
        }
      </div>

    </div>
</div>

  <!-- Email -->
  <div class="form-control">
    <label for="email">Email</label>
    <input
      id="email"
      name="email"
      type="email"
      placeholder="Email"
      [(ngModel)]="applicantForm.email"
      #email="ngModel"
      required
      email
    />
    @if (email.touched && email.invalid) {
      <small>
        @if (email.errors?.['required']) { Email is required. }
        @if (email.errors?.['email']) { Enter a valid email. }
      </small>
    }
  </div>

  <!-- Employment status (radio group) -->
  <div class="radio-group">
    <p>What is your current employment status?</p>

    <label class="form-radio-control">
      <input
        type="radio"
        name="employmentStatus"
        value="employed"
        [(ngModel)]="applicantForm.employmentStatus"
        #employmentStatus="ngModel"
        required
      />
      Employed
    </label>

    <label class="form-radio-control">
      <input
        type="radio"
        name="employmentStatus"
        value="self-employed"
        [(ngModel)]="applicantForm.employmentStatus"
        required
      />
      Self-employed
    </label>

    <label class="form-radio-control">
      <input
        type="radio"
        name="employmentStatus"
        value="unemployed"
        [(ngModel)]="applicantForm.employmentStatus"
        required
      />
      Unemployed
    </label>

    <label class="form-radio-control">
      <input
        type="radio"
        name="employmentStatus"
        value="student"
        [(ngModel)]="applicantForm.employmentStatus"
        required
      />
      Student
    </label>

    @if (employmentStatus.touched && employmentStatus.invalid) {
      <small class="error">Please choose an option.</small>
    }
  </div>

  <!-- Position select -->
  <div class="form-control">
    <label for="open-positions">What position are you applying for?</label>
    <select
      id="open-positions"
      name="positionSelected"
      [(ngModel)]="applicantForm.positionSelected"
      #positionSelected="ngModel"
      required
    >
      <option value="" disabled>Select an option</option>
      @for (p of positions; track p) {
        <option [value]="p">{{ p }}</option>
      }
    </select>
    @if (positionSelected.touched && positionSelected.invalid) {
      <small>Please select a position.</small>
    }
  </div>

  <!-- Resume link -->
  <div class="form-control">
    <label for="resume-link">Please provide your resume link</label>
    <input
      id="resume-link"
      name="resumeLink"
      type="url"
      placeholder="https://www.example.com"
      [(ngModel)]="applicantForm.resumeLink"
      #resumeLink="ngModel"
      required
      pattern="https?://.+"
    />
    @if (resumeLink.touched && resumeLink.invalid) {
      <small>
        @if (resumeLink.errors?.['required']) { Resume link is required. }
        @if (resumeLink.errors?.['pattern']) { Enter a valid URL (starts with http/https). }
      </small>
    }
  </div>

  <div class="radio-group">
    Verify Account width:
    <div class="form-radio-control">
      <input
        type="radio"
        name="verify-account"
        id="verify-email"
        [(ngModel)]="verifyAccountWith"
        (ngModelChange)="handlePhoneNumber()"
        [ngModelOptions]="{standalone: true }"
        value="email"
      >
      <label for="verify-email">Email</label>
    </div>
    <div class="form-radio-control">
      <input
        type="radio"
        name="verify-account"
        [(ngModel)]="verifyAccountWith"
        (ngModelChange)="handlePhoneNumber()"
        [ngModelOptions]="{standalone: true }"
        id="verify-phone-number"
        value="phone number"
      >
      <label for="verify-phone-number">Phone number</label>
    </div>
  </div>

  <!-- phone number -->
  @if(verifyAccountWith === 'phone number'){
    <div class="form-control">
      <label for="phone-number">Phone number</label>
      <input
        type="text"
        id="phone-number"
        name="phone-number"
        placeholder="phone-number"
        [(ngModel)]="applicantForm.phoneNumber"
        minlength="4"
        pattern="\d"
        #phoneNumber="ngModel"

      />
      <!--    (keypress)="handleKeypress($event)"  -->
      @if (phoneNumber.touched && phoneNumber.invalid) {
        <small>
          @if (phoneNumber.errors?.['required']) { this field is required. }
          @if (phoneNumber.errors?.['pattern']) { this field only accepts numbers). }
          @if (phoneNumber.hasError('minlength')) {
            @let minlength = phoneNumber.getError('minlength');
            The required length for this field is  <strong>{{ minlength }}</strong>
          }
        </small>
      }
    </div>
  }



  <div class="form-action">
    <button type="button" class="btn btn-primary" (click)="onReset(form)">Reset</button>
    <button type="submit" class="btn button-btn-secondary" [disabled]="form.invalid">Submit</button>
  </div>
</form>

<!--<pre>{{ applicantForm | json }}</pre>-->
